########  README  ########
######## Date: 2024-05-08 ########

This repository contains original codes for major analyses in the manuscript 'Multimodal Metagenomic Analysis of Bronchoalveolar Lavage Fluid Enables Differential Diagnosis Between Lung Cancer and Pulmonary Infections'. 
All data are included in the 'data' directory. In "pipeline" and "machine_learning_scripts" folders, the codes for the major analyses are included. The processed microbiome and host data for all 402 individuals are provided.  
All data published were accorded to Human Genetic Resources Administration of China regulation and to comply with informed consent.

####### pipeline ########



######## data ########

We put all intermediate results into folders below:

CNV: copy number variants information table
Cell_proportion: immune cell proprotion table estimated by CIBERTSORT
DNA_micro: bacteria, fungi, viruses and bacteriophage relative abundance table from DNA data of all 402 clinical samples and Negative controls
RNA_micro: bacteria, fungi, viruses and bacteriophage relative abundance table from RNA data of all 402 clinical samples and Negative controls
RNA_EXP: host gene expression raw count table
TE_EXP: Transposable element expression raw count table

######## mechine_learning_script ########


This R script was used for building up classifiers.

File Annotation:

"mlr3_RandomForest.R" is the main R script.
"Infection_vs_Cancer_difftable.txt", "Bacteria_vs_Cancer_difftable.txt", "Fungi_vs_Cancer_difftable.txt" and "TE_vs_Cancer_difftable.txt" was differential features table. Host Gene and Transposable Elements(TE) expression were transformed into TPM. Microbial and bacteriophage were used relative abundances. Other features were remained orginal values.
"trainset_all.txt" was group annotation file of trainset between infection and lung cancer. "testset_all.txt" was group annotation file of validation set between infection and lung cancer. "trainset_subgroup.txt" was group annotation file of trainset among subgroup infection and lung cancer. "testset_subgroup.txt" was group annotation file of validation set among subgroup infection and lung cancer. 

Command Line:
Infection vs Cancer: Rscript mlr3_RandomForest.R Infection_vs_Cancer_difftable.txt Infection trainset_all.txt testset_all.txt
Bacteria vs Cancer: Rscript mlr3_RandomForest.R Bacteria_vs_Cancer_difftable.txt Bacteria trainset_subgruop.txt testset_subgroup.txt
Fungi vs Cancer: Rscript mlr3_RandomForest.R Fungi_vs_Cancer_difftable.txt Fungi trainset_subgruop.txt testset_subgroup.txt
TB vs Cancer: Rscript mlr3_RandomForest.R TB_vs_Cancer_difftable.txt TB trainset_subgruop.txt testset_subgroup.txt

########  END  ########
